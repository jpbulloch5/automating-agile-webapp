# Docker
# Build and push an image to Azure Container Registry
# https://docs.microsoft.com/azure/devops/pipelines/languages/docker

trigger:
- dev


resources:
- repo: self


pool:
  vmImage: 'ubuntu-latest'

 
steps:
- task: Docker@2
  inputs:
    containerRegistry: 'Jacob''s Docker Hub'
    repository: 'jpbulloch5/revature_p1_webapp'
    command: 'buildAndPush'
    Dockerfile: '**/Dockerfile'
  displayName: Build WebApp in container and push image to DockerHub

- task: DockerCompose@0
  inputs:
    containerregistrytype: 'Container Registry'
    dockerRegistryEndpoint: 'Jacob''s Docker Hub'
    dockerComposeFile: '**/docker-compose.yml'
    action: 'Run a Docker Compose command'
    dockerComposeCommand: 'up'
    arguments: '-d'
  displayName: start the Dockerized application network

- task: CmdLine@2
  inputs:
    script: 'docker cp airline_terminal:/app/web/P1_Local_Postman_Collection.json ./local_test.json'
    failOnStderr: true
  displayName: fetch test from container

